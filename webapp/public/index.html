<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>🏎️ EcoTele Web Dashboard</title>
    <link rel="icon" href="data:," />

    <!-- Leaflet (GPS map) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- ECharts (charts & gauges) -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    <!-- Ably JS SDK (CDN v2 locked as recommended) -->
    <script src="https://cdn.ably.com/lib/ably.min-2.js"></script>

    <!-- Supabase JS (for direct browser usage if needed) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="./styles.css" />
    <script src="./config.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="title">🏎️ Shell Eco-marathon Telemetry Dashboard</div>
      <div id="status-pill" class="status-indicator">Disconnected</div>
    </header>

    <div class="app">
      <aside class="sidebar">
        <section class="card">
          <h3>🔧 Connection</h3>
          <div class="row">
            <button id="btn-connect">Connect</button>
            <button id="btn-disconnect">Disconnect</button>
          </div>
          <div class="grid2">
            <div>
              <div class="label">Messages</div>
              <div id="stat-msg" class="metric">0</div>
            </div>
            <div>
              <div class="label">Errors</div>
              <div id="stat-err" class="metric">0</div>
            </div>
          </div>
          <div class="grid2">
            <div>
              <div class="label">Last Msg</div>
              <div id="stat-last" class="metric">—</div>
            </div>
            <div>
              <div class="label">Mode</div>
              <select id="mode-select">
                <option value="realtime">🔴 Realtime</option>
                <option value="historical">📚 Historical</option>
              </select>
            </div>
          </div>
        </section>

        <section class="card" id="historical-panel" style="display: none">
          <h3>📚 Sessions</h3>
          <button id="btn-refresh-sessions">Refresh Sessions</button>
          <div class="label small">Recent sessions</div>
          <select id="session-select" size="8"></select>
          <div class="row">
            <button id="btn-load-session">Load Session</button>
          </div>
          <div id="session-info" class="small"></div>
        </section>

        <section class="card">
          <h3>⚙️ Settings</h3>
          <div class="row">
            <label>
              <input id="auto-scroll" type="checkbox" checked />
              Auto-scroll charts
            </label>
          </div>
          <div class="row">
            <label>
              Max points in memory:
              <input id="max-points" type="number" value="50000" min="5000" />
            </label>
          </div>
          <div class="fine">
            Channel: <code id="info-channel"></code>
          </div>
        </section>

        <section class="card">
          <h3>📤 Export</h3>
          <button id="btn-download-csv">Download Full CSV</button>
          <button id="btn-download-sample">Download Sample (1000)</button>
        </section>
      </aside>

      <main class="main">
        <section class="card strong">
          <div class="kpi-grid">
            <div class="kpi">
              <div class="kpi-label">📏 Distance</div>
              <div id="kpi-distance" class="kpi-value">0.00 km</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">🏃 Max Speed</div>
              <div id="kpi-maxspeed" class="kpi-value">0.0 km/h</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">⚡ Avg Speed</div>
              <div id="kpi-avgspeed" class="kpi-value">0.0 km/h</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">🔋 Energy</div>
              <div id="kpi-energy" class="kpi-value">0.00 kWh</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">⚡ Voltage</div>
              <div id="kpi-voltage" class="kpi-value">0.0 V</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">🔄 Current</div>
              <div id="kpi-current" class="kpi-value">0.0 A</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">💡 Avg Power</div>
              <div id="kpi-avgpower" class="kpi-value">0.0 W</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">🌊 Avg Current</div>
              <div id="kpi-avgcurrent" class="kpi-value">0.0 A</div>
            </div>
          </div>
        </section>

        <section class="card">
          <h3>📊 Live Performance Gauges</h3>
          <div class="gauge-grid">
            <div id="gauge-speed" class="gauge"></div>
            <div id="gauge-battery" class="gauge"></div>
            <div id="gauge-power" class="gauge"></div>
            <div id="gauge-efficiency" class="gauge"></div>
            <div id="gauge-roll" class="gauge"></div>
            <div id="gauge-pitch" class="gauge"></div>
          </div>
        </section>

        <nav class="tabs">
          <button class="tab active" data-tab="overview">📊 Overview</button>
          <button class="tab" data-tab="speed">🚗 Speed</button>
          <button class="tab" data-tab="power">⚡ Power</button>
          <button class="tab" data-tab="imu">🎮 IMU</button>
          <button class="tab" data-tab="imu-detail">🎮 IMU Detail</button>
          <button class="tab" data-tab="efficiency">⚡ Efficiency</button>
          <button class="tab" data-tab="gps">🛰️ GPS</button>
          <button class="tab" data-tab="custom">📈 Custom</button>
          <button class="tab" data-tab="data">📃 Data</button>
        </nav>

        <section id="panel-overview" class="panel active">
          <div id="chart-overview-note" class="fine">
            Realtime key performance indicators for your vehicle
          </div>
        </section>

        <section id="panel-speed" class="panel">
          <div id="chart-speed" class="chart"></div>
        </section>

        <section id="panel-power" class="panel">
          <div id="chart-power" class="chart tall"></div>
        </section>

        <section id="panel-imu" class="panel">
          <div id="chart-imu" class="chart xltall"></div>
        </section>

        <section id="panel-imu-detail" class="panel">
          <div id="chart-imu-detail" class="chart xxl"></div>
        </section>

        <section id="panel-efficiency" class="panel">
          <div id="chart-efficiency" class="chart"></div>
        </section>

        <section id="panel-gps" class="panel">
          <div class="split">
            <div id="map" class="map"></div>
            <div id="chart-altitude" class="chart"></div>
          </div>
        </section>

        <section id="panel-custom" class="panel">
          <div class="row">
            <button id="btn-add-chart">➕ Add Chart</button>
          </div>
          <div id="custom-charts"></div>
        </section>

        <section id="panel-data" class="panel">
          <div id="quality-notes" class="note-list"></div>
          <div class="row">
            <div id="dataset-stats" class="fine"></div>
          </div>
          <div class="table-wrap">
            <table id="data-table">
              <thead id="data-thead"></thead>
              <tbody id="data-tbody"></tbody>
            </table>
          </div>
        </section>
      </main>
    </div>

    <footer class="footer">
      <div>Shell Eco-marathon Telemetry Dashboard</div>
    </footer>

    <script src="./app.js"></script>
  </body>
</html>
