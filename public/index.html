<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>ğŸï¸ Shell Eco-marathon Telemetry Dashboard</title>

    <!-- App styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- jQuery DataTables + Responsive -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css"
    />

    <!-- Leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <!-- Optional config (define window.CONFIG before app.js if needed) -->
    <script>
      window.CONFIG = window.CONFIG || {
        ABLY_CHANNEL_NAME: "telemetry-dashboard-channel",
        ABLY_AUTH_URL: "/api/ably/token",
        // ABLY_API_KEY: "your-ably-key" // only if you choose to embed it
      };
    </script>
  </head>
  <body>
    <div id="layout" class="app-container">
      <!-- Backdrop overlay for mobile -->
      <div id="sidebar-backdrop" class="sidebar-backdrop"></div>
      
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar">
        <!-- Close button for mobile -->
        <button id="sidebar-close" class="sidebar-close-btn" aria-label="Close sidebar">
          âœ•
        </button>
        
        <div class="glass-panel" style="padding: 1.2rem; margin-bottom: 1rem">
          <h2
            style="
              margin: 0 0 0.25rem 0;
              font-size: 1.2rem;
              font-weight: 800;
            "
          >
            ğŸï¸ Telemetry Control
          </h2>
          <p class="fine" style="margin: 0">Real-time vehicle monitoring</p>
        </div>

        <!-- Connection -->
        <div class="card glass-panel">
          <h3>Connection</h3>
          <div class="row">
            <span id="status-pill" class="status-indicator">Disconnected</span>
          </div>
          <div class="row">
            <button id="btn-connect" class="liquid-hover">Connect</button>
            <button id="btn-disconnect" class="liquid-hover">Disconnect</button>
          </div>
          <div class="row">
            <span class="label small">Channel:</span>
            <span id="info-channel" class="metric">-</span>
          </div>
        </div>

        <!-- Mode -->
        <div class="card glass-panel">
          <h3>Data Mode</h3>
          <select id="mode-select" class="liquid-hover">
            <option value="realtime">ğŸ“¡ Real-time</option>
            <option value="historical">ğŸ“Š Historical</option>
          </select>
        </div>

        <!-- Historical sessions -->
        <div
          id="historical-panel"
          class="card glass-panel"
          style="display: none"
        >
          <h3>ğŸ“ˆ Historical Sessions</h3>
          <div class="row">
            <button id="btn-refresh-sessions" class="liquid-hover">
              ğŸ”„ Refresh
            </button>
          </div>
          <select id="session-select" multiple class="listbox liquid-hover">
            <option value="">Loading sessions...</option>
          </select>
          <div class="row">
            <button id="btn-load-session" class="liquid-hover">
              ğŸ“¥ Load Session
            </button>
          </div>
          <div id="session-info" class="fine" style="margin-top: 0.5rem"></div>
        </div>

        <!-- Stats -->
        <div class="card glass-panel">
          <h3>ğŸ“Š Statistics</h3>
          <div class="row">
            <span class="label">Messages:</span>
            <span id="stat-msg" class="metric">0</span>
          </div>
          <div class="row">
            <span class="label">Errors:</span>
            <span id="stat-err" class="metric">0</span>
          </div>
          <div class="row">
            <span class="label small">Last Update:</span>
            <span id="stat-last" class="fine">Never</span>
          </div>
        </div>

        <!-- Export -->
        <div class="card glass-panel">
          <h3>ğŸ’¾ Export</h3>
          <div class="row">
            <button id="btn-download-csv" class="liquid-hover">
              ğŸ“„ Download CSV
            </button>
          </div>
          <div class="row">
            <button id="btn-download-sample" class="liquid-hover">
              ğŸ”¬ Sample Data
            </button>
          </div>
          <div class="row">
            <label class="label small">Max Points:</label>
            <input
              id="max-points"
              type="number"
              value="50000"
              min="1000"
              max="100000"
              step="1000"
              class="liquid-hover"
            />
          </div>
        </div>
      </aside>

      <!-- Main -->
      <main class="main-content">
        <header class="header">
          <div style="display: flex; align-items: center; gap: 1rem">
            <button
              id="sidebar-toggle"
              class="liquid-hover"
              style="
                background: none;
                border: 1px solid var(--hairline);
                padding: 0.5rem;
                border-radius: 8px;
              "
            >
              â˜°
            </button>
            <h1 class="title">Shell Eco-marathon Telemetry Dashboard</h1>
          </div>
          <div class="status-indicator" id="connection-status">âš¡ Ready</div>
        </header>

        <div class="main">
          <!-- Tabs -->
          <div class="tabs">
            <button class="tab active liquid-hover" data-panel="overview">
              ğŸ“Š Overview
            </button>
            <button class="tab liquid-hover" data-panel="speed">ğŸš— Speed</button>
            <button class="tab liquid-hover" data-panel="power">âš¡ Power</button>
            <button class="tab liquid-hover" data-panel="imu">ğŸ§­ IMU</button>
            <button class="tab liquid-hover" data-panel="imu-detail">
              ğŸ® IMU Detail
            </button>
            <button class="tab liquid-hover" data-panel="gforces">
              ğŸŒŠ G-Forces
            </button>
            <button class="tab liquid-hover" data-panel="efficiency">
              ğŸ“ˆ Efficiency
            </button>
            <button class="tab liquid-hover" data-panel="gps">ğŸ—ºï¸ GPS</button>
            <button class="tab liquid-hover" data-panel="custom">
              ğŸ¨ Custom
            </button>
            <button class="tab liquid-hover" data-panel="data">ğŸ“‹ Data</button>
          </div>

          <!-- Overview -->
          <section id="panel-overview" class="panel active">
            <!-- KPIs -->
            <div class="glass-panel" style="margin-bottom: 1.2rem">
              <h3 style="margin-top: 0; font-weight: 800">
                ğŸ“Š Key Performance Indicators
              </h3>
              <div class="kpi-grid">
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ“ Distance</div>
                  <div id="kpi-distance" class="kpi-value">0.00 km</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸƒ Max Speed</div>
                  <div id="kpi-maxspeed" class="kpi-value">0.0 km/h</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">âš¡ Avg Speed</div>
                  <div id="kpi-avgspeed" class="kpi-value">0.0 km/h</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ”‹ Energy</div>
                  <div id="kpi-energy" class="kpi-value">0.00 kWh</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">âš¡ Voltage</div>
                  <div id="kpi-voltage" class="kpi-value">0.00 V</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ”„ Current</div>
                  <div id="kpi-current" class="kpi-value">0.00 A</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ’¡ Avg Power</div>
                  <div id="kpi-avgpower" class="kpi-value">0.00 W</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸŒŠ Avg Current</div>
                  <div id="kpi-avgcurrent" class="kpi-value">0.00 A</div>
                </div>
              </div>
            </div>

            <!-- Gauges (last tile hosts minimal Friction Circle) -->
            <div class="glass-panel" style="margin-bottom: 1.2rem">
              <h3 style="margin-top: 0; font-weight: 800">
                ğŸ“Š Live Performance Gauges
              </h3>
              <div class="gauge-grid">
                <div class="gauge-wrap">
                  <div class="gauge" id="gauge-speed"></div>
                  <div class="gauge-title">Speed (km/h)</div>
                </div>
                <div class="gauge-wrap">
                  <div class="gauge" id="gauge-battery"></div>
                  <div class="gauge-title">Battery (%)</div>
                </div>
                <div class="gauge-wrap">
                  <div class="gauge" id="gauge-power"></div>
                  <div class="gauge-title">Power (W)</div>
                </div>
                <div class="gauge-wrap">
                  <div class="gauge" id="gauge-efficiency"></div>
                  <div class="gauge-title">Efficiency (km/kWh)</div>
                </div>
                <div class="gauge-wrap">
                  <div class="gauge" id="gauge-total-g"></div>
                  <div class="gauge-title">G Forces</div>
                </div>
              </div>
            </div>

            <!-- Driver Inputs (smaller) -->
            <div class="glass-panel driver-box">
              <h3 style="margin: 0 0 0.4rem 0; font-weight: 800">
                ğŸ® Driver Inputs (Live)
              </h3>
              <div class="chart tiny" id="chart-pedals"></div>
              <div class="center fine">Brake and Throttle (0â€“100%)</div>
            </div>
          </section>

          <!-- Speed -->
          <section id="panel-speed" class="panel">
            <div class="glass-panel">
              <div class="chart tall" id="chart-speed"></div>
            </div>
          </section>

          <!-- Power -->
          <section id="panel-power" class="panel">
            <div class="glass-panel">
              <div class="chart tall" id="chart-power"></div>
            </div>
          </section>

          <!-- IMU -->
          <section id="panel-imu" class="panel">
            <div class="glass-panel">
              <div class="chart tall" id="chart-imu"></div>
            </div>
          </section>

          <!-- IMU Detail -->
          <section id="panel-imu-detail" class="panel">
            <div class="glass-panel">
              <div class="chart xxl" id="chart-imu-detail"></div>
            </div>
          </section>

          <!-- G-Forces -->
          <section id="panel-gforces" class="panel">
            <div class="glass-panel">
              <div class="chart tall" id="chart-gforces"></div>
            </div>
          </section>

          <!-- Efficiency -->
          <section id="panel-efficiency" class="panel">
            <div class="glass-panel">
              <div class="chart tall" id="chart-efficiency"></div>
            </div>
          </section>

          <!-- GPS -->
          <section id="panel-gps" class="panel">
            <div class="split">
              <div class="glass-panel">
                <div class="map" id="map"></div>
              </div>
              <div class="glass-panel">
                <div class="chart" id="chart-altitude"></div>
              </div>
            </div>
          </section>

          <!-- Custom -->
          <section id="panel-custom" class="panel">
            <div
              class="glass-panel"
              style="padding: 1.2rem; text-align: center"
            >
              <h3>ğŸ¨ Custom Charts</h3>
              <p class="fine">
                Click <strong>"Add Chart"</strong> to create custom
                visualizations.
              </p>
              <button
                id="btn-add-custom-chart"
                class="liquid-hover"
                style="margin-top: 0.6rem"
              >
                â• Add Chart
              </button>
            </div>
            <div id="custom-charts-container"></div>
          </section>

          <!-- Data -->
          <section id="panel-data" class="panel">
            <!-- Table first -->
            <div class="data-quality-table">
              <div
                style="
                  padding: 1.2rem 1.2rem 0.8rem 1.2rem;
                  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                "
              >
                <h3
                  style="
                    margin: 0;
                    font-weight: 800;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  ğŸ“‹ Raw Telemetry Data
                  <span
                    id="data-count"
                    style="font-size: 0.9rem; color: var(--text-subtle)"
                  ></span>
                </h3>
              </div>
              <div class="table-wrap">
                <table
                  id="data-table"
                  class="display responsive nowrap"
                  style="width: 100%"
                ></table>
              </div>
            </div>

            <!-- Data Quality below the table -->
            <div class="glass-panel" style="padding: 1.2rem">
              <h3 style="margin-top: 0; font-weight: 800">
                ğŸ” Data Quality Metrics
              </h3>
              <!-- quick summary -->
              <div class="kpi-grid" style="margin-bottom: 1rem">
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ“Š Total Records</div>
                  <div id="total-records" class="kpi-value">0</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">âœ… Complete Records</div>
                  <div id="complete-records" class="kpi-value">0%</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">âŒ Missing Values</div>
                  <div id="missing-values" class="kpi-value">0%</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ”„ Duplicates</div>
                  <div id="duplicate-records" class="kpi-value">0</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">âš ï¸ Anomalies</div>
                  <div id="anomalies-detected" class="kpi-value">0</div>
                </div>
                <div class="kpi liquid-hover">
                  <div class="kpi-label">ğŸ“ˆ Quality Score</div>
                  <div id="quality-score" class="kpi-value">0%</div>
                </div>
              </div>

              <!-- alerts -->
              <div id="quality-alerts" class="note-list"></div>

              <!-- details -->
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(
                    auto-fit,
                    minmax(280px, 1fr)
                  );
                  gap: 0.8rem;
                "
              >
                <div class="metric-card-enhanced">
                  <h4 style="margin: 0 0 0.6rem 0; font-weight: 700">
                    ğŸ“Š Field Completeness
                  </h4>
                  <div id="field-completeness" class="small"></div>
                </div>
                <div class="metric-card-enhanced">
                  <h4 style="margin: 0 0 0.6rem 0; font-weight: 700">
                    â±ï¸ Data Freshness
                  </h4>
                  <div id="data-freshness" class="small"></div>
                </div>
                <div class="metric-card-enhanced">
                  <h4 style="margin: 0 0 0.6rem 0; font-weight: 700">
                    ğŸ¯ Data Accuracy
                  </h4>
                  <div id="data-accuracy" class="small"></div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <footer class="footer">
          <div class="glass-panel" style="padding: 1rem; text-align: center">
            <p class="fine" style="margin: 0">
              ğŸï¸ Shell Eco-marathon Telemetry Dashboard
            </p>
          </div>
        </footer>
      </main>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- App logic -->
    <script src="app.js"></script>
  </body>
</html>